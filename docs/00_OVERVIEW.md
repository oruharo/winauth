# 第0章: プロジェクト概要

## 0.1 背景と課題

### 0.1.1 現状の環境構成

本プロジェクトは、以下のような複数ドメイン環境を前提としています：

- **国内環境**: 本社・国内拠点が所属するドメイン（DOMAIN1.LAB）
- **海外環境**: 複数の海外拠点が独立運営する別ドメイン（DOMAIN2.LAB, DOMAIN3.LAB...）
- **信頼関係**: 各ドメイン間で双方向の信頼関係を確立済み

各拠点は独立して運営されており、それぞれが独自のActive Directoryドメインを持っています。しかし、業務上の必要性から、ドメイン間では双方向の信頼関係が構築されています。

### 0.1.2 要件

**シングルサインオン（SSO）の実現**

海外拠点のユーザーが、国内で運営されているWebアプリケーションにアクセスする際、以下の要件を満たす必要があります：

1. **シームレスなアクセス**: 海外ドメインのユーザーも国内Webアプリにアクセス可能
2. **パスワードレス認証**: Windowsクライアントへのログインで認証完了
3. **自動ログイン**: アプリケーション起動時にID・パスワードの入力不要
4. **認証済みユーザーIDの取得**: 認証したユーザーのID（ドメイン名とユーザー名）をアプリケーションで取得し、アクセス制御や監査ログに使用したい
5. **セキュリティ**: 適切な認証・認可の仕組み
6. **Linux/コンテナ環境**: アプリケーションはLinux/コンテナ環境（Kubernetes）で動作させる。Windowsアプリケーションサーバーは追加構築せずに実現したい


## 0.2 プロジェクトの目的

このプロジェクトは、上記要件を実現するために**Windows統合認証**を使用した調査検証を行うものです。

### 0.2.1 検証内容

1. **技術調査**: Windows統合認証（Kerberos/NTLM）の仕組みと実装方法
2. **クロスドメイン認証**: 複数ドメイン環境でのSSO実現方法
3. **プロトタイプ構築**: 実際に動作する検証環境の構築
4. **課題の洗い出し**: 実装上の技術的課題とその解決策

### 0.2.2 成果物

- **技術ドキュメント**: Windows統合認証の詳細仕様と実装ガイド
- **動作環境**: AWS上に構築された検証環境
- **サンプルコード**: Spring Boot + React によるリファレンス実装
- **運用手順**: デプロイ・運用のための自動化スクリプト

## 0.3 技術的アプローチ

### 0.3.1 採用技術

**認証プロトコル**:
- Kerberos認証（SPNEGO）: 高セキュリティ、高パフォーマンス
- NTLM認証: 設定簡素化、クロスドメイン対応が容易

**アプリケーション構成**:
- **バックエンド**: Spring Boot（Java 17）
- **フロントエンド**: React + TypeScript
- **コンテナ**: Docker + Docker Compose
- **Webサーバー**: Nginx

**インフラストラクチャ**:
- **クラウド**: AWS（EC2, ALB, VPC）
- **IaC**: CloudFormation
- **構成管理**: Ansible
- **自動化**: Makefile

### 0.3.2 検証環境構成

```
┌─────────────────────────────────────────────────────┐
│                      AWS Cloud                       │
│                                                      │
│  ┌──────────────┐         ┌──────────────┐         │
│  │   DOMAIN1    │  双方向  │   DOMAIN2    │         │
│  │  (国内拠点)   │ ◀─────▶ │  (海外拠点)   │         │
│  │  DC1, WIN1   │  信頼関係 │  DC2, WIN2   │         │
│  └──────────────┘         └──────────────┘         │
│                                                      │
│           │                      │                  │
│           └──────────┬───────────┘                  │
│                      │                              │
│                ┌─────▼─────┐                        │
│                │    ALB    │                        │
│                └─────┬─────┘                        │
│                      │                              │
│            ┌─────────▼──────────┐                   │
│            │   Linux Host       │                   │
│            │  ┌──────────────┐  │                   │
│            │  │  Container   │  │                   │
│            │  │  (App+Nginx) │  │                   │
│            │  └──────────────┘  │                   │
│            └────────────────────┘                   │
└─────────────────────────────────────────────────────┘
```

### 0.3.3 検証の焦点

**主要な検証項目**:

1. **単一ドメイン認証**: DOMAIN1ユーザーの認証動作確認
2. **クロスドメイン認証**: DOMAIN2ユーザーの認証動作確認
3. **認証方式の比較**: Kerberos vs NTLM の実装・運用比較
4. **セキュリティ評価**: 各認証方式のセキュリティリスク評価
5. **運用性評価**: デプロイ・保守の容易性評価

## 0.4 ドキュメント構成

本技術ドキュメントは、以下の章で構成されています：

- **[第1章: Windows統合認証の基礎](./01_WINDOWS_INTEGRATED_AUTH.md)** - 認証方式の概要と選択基準
- **[第2章: Kerberos認証詳解](./02_KERBEROS.md)** - Kerberos認証の技術詳細
- **[第3章: NTLM認証詳解](./03_NTLM.md)** - NTLM認証の実装ガイド
- **[第4章: クロスドメイン認証](./04_CROSS_DOMAIN.md)** - クロスドメイン環境での認証課題と解決策
- **[第5章: 環境別セットアップ](./05_SETUP.md)** - 実際の環境構築手順
- **[第6章: トラブルシューティング](./06_TROUBLESHOOTING.md)** - よくある問題と解決策

## 0.5 想定読者

このドキュメントは、以下の読者を想定しています：

- **システムアーキテクト**: 認証システムの設計・選定を行う方
- **開発エンジニア**: 実際の実装を担当する方
- **インフラエンジニア**: 環境構築・運用を担当する方
- **セキュリティエンジニア**: セキュリティ評価を行う方

## 次の章へ

- [第1章: Windows統合認証の基礎](./01_WINDOWS_INTEGRATED_AUTH.md) - 認証方式の詳細へ進む
